<link rel="import" href="../../components/polymer/polymer.html">

<!-- build:remove -->
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/iron-icon/iron-icon.html">
<link rel="import" href="../../components/iron-icons/av-icons.html">
<link rel="import" href="../../components/iron-icons/image-icons.html">
<!-- /build -->

<dom-module id="ez-stat-counter">
    <template>

        <!-- build:remove -->

        <style>
            :host {
                display: block;
                -webkit-transition: background 0.3s, box-shadow 0.3s;
                -moz-transition: background 0.3s, box-shadow 0.3s;
            }

            .text {
                position: relative;
                top: 0.5em;
            }

            .secondary {
                position: relative;
                top: -0.8em;
                font-size: 0.8em;
                color: rgba(0, 0, 0, 0.6);
            }

            .button {
                transition: all 0.2s;
                min-width: 0;
                /*width:  1em;*/
                margin: 0;
            }

            .button[disabled] {
                background-color: rgba(0, 0, 0, 0);
            }

            .button:hover {
                background: rgba(0, 0, 0, 0.2);
            }

            .inline-container {
                display: flex;
                justify-content: space-between;
                width: 50vw;
            }

            /*.stats-container {*/
            /*display:*/
            /*}*/


        </style>
        <iron-ajax
                id="setGame"
                url="/games/[[game._id]]"
                handle-as="json"
                content-type="application/json"
                method="PUT"
                debounce-duration="3000">
        </iron-ajax>

        <iron-ajax
                id="getGame"
                auto
                url="/games/[[game._id]]"
                handle-as="json"
                content-type="application/json">
        </iron-ajax>

        <iron-ajax
                id="getPlayer"
                auto
                url="/players/[[selected]]"
                handle-as="json"
                last-response="{{player}}"
                debounce-duration="300"></iron-ajax>

        <iron-ajax
                id="setField"
                url="/players/[[selected]]"
                handle-as="json"
                content-type="application/json"
                method="PUT"
                timeout="1000">
        </iron-ajax>
        <paper-item>
            <p id="selectPlayer" style="display: none">[[selected]]</p>
            <!--<p id="selectPlayer">[[selected]]</p>-->
            <div class="stats-container">
                <paper-item-body>
                    <div class="inline-container">
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractAssist">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getAssists">{{player.assists}}</div>
                            <div class="secondary">Assists</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addAssist">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractSuccesfulPasses">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getSuccesfulPasses">{{player.succesfulPasses}}</div>
                            <div class="secondary">Succesful Passes</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addSuccesfulPasses">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractFailedPasses">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getFailedPasses">{{player.failedPasses}}</div>
                            <div class="secondary">Failed Passes</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addFailedPasses">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractLostBalls">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getLostBalls">{{player.lostBalls}}</div>
                            <div class="secondary">Lost Balls</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addLostBalls">+
                            </paper-button>
                        </template>
                    </div>
                </paper-item-body>

                <paper-item-body>
                    <div class="inline-container">
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractRecoveredBalls">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getRecoveredBalls">{{player.recoveredBalls}}</div>
                            <div class="secondary">Recovered Balls</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addRecoveredBalls">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractFreeshotsScored">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getFreeshotsScored">{{player.freeshotsScored}}</div>
                            <div class="secondary">Freeshots Scored</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addFreeshotsScored">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractFreeshotsMissed">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getFreeshotsMissed">{{player.freeshotsMissed}}</div>
                            <div class="secondary">Freeshots Missed</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addFreeshotsMissed">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractFouls">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getFouls">{{player.fouls}}</div>
                            <div class="secondary">Fouls</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addFouls">+
                            </paper-button>
                        </template>
                    </div>
                </paper-item-body>

                <paper-item-body>
                    <div class="inline-container">
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractTechnicalFouls">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getTechnicalFouls">{{player.technicalFouls}}</div>
                            <div class="secondary">Technical Fouls</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addTechnicalFouls">+
                            </paper-button>
                        </template>

                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="minus" class="button"
                                          on-click="_subtractUnsportsmanshipFouls">
                                -
                            </paper-button>
                        </template>
                        <div class="text">
                            <div id="getUnsportsmanshipFouls">{{player.unsportsmanshipFouls}}</div>
                            <div class="secondary">Unsportsmanship Fouls</div>
                        </div>
                        <template is="dom-if" if="{{editable}}">
                            <paper-button disabled="{{disabled}}" id="plus" class="button"
                                          on-click="_addUnsportsmanshipFouls">+
                            </paper-button>
                        </template>
                    </div>
                </paper-item-body>
            </div>
        </paper-item>
        </div>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'ez-stat-counter',

                //
                <!-- build:remove -->
                listeners: {},

                properties: {
                    name: String,
                    href: String,
                    value: String,
                    game: Object,
                    selected: {type: String, notify: true},
                    editable: {
                        type: Boolean,
                        default: false,
                        reflectToAttribute: true
                    },
                    disabled: {
                        type: Boolean,
                        default: true,
                        reflectToAttribute: true
                    }
                },

                _addAssist: function (evt) {
                    var newValue = parseInt(this.$.getAssists.innerHTML) + 1;
                    this.$.getAssists.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "assists": newValue
                    });

                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'assist',
                            value: newValue
                        }
                    })
                },

                _subtractAssist: function (evt) {
                    var newValue = parseInt(this.$.getAssists.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getAssists.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "assists": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'assist',
                            value: newValue
                        }
                    })
                },
                _addSuccesfulPasses: function (evt) {
                    var newValue = parseInt(this.$.getSuccesfulPasses.innerHTML) + 1;
                    this.$.getSuccesfulPasses.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "succesfulPasses": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'successfulPasses',
                            value: newValue
                        }
                    })
                },

                _subtractSuccesfulPasses: function (evt) {
                    var newValue = parseInt(this.$.getSuccesfulPasses.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getSuccesfulPasses.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "succesfulPasses": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'successfulPasses',
                            value: newValue
                        }
                    })
                },
                _addFailedPasses: function (evt) {
                    var newValue = parseInt(this.$.getFailedPasses.innerHTML) + 1;
                    this.$.getFailedPasses.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "failedPasses": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'failedPasses',
                            value: newValue
                        }
                    })
                },

                _subtractFailedPasses: function (evt) {
                    var newValue = parseInt(this.$.getFailedPasses.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFailedPasses.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "failedPasses": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'failedPasses',
                            value: newValue
                        }
                    })
                },
                _addLostBalls: function (evt) {
                    var newValue = parseInt(this.$.getLostBalls.innerHTML) + 1;
                    this.$.getLostBalls.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "lostBalls": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'lostBalls',
                            value: newValue
                        }
                    })
                },

                _subtractLostBalls: function (evt) {
                    var newValue = parseInt(this.$.getLostBalls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getLostBalls.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "lostBalls": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'lostBalls',
                            value: newValue
                        }
                    })
                },

                _addRecoveredBalls: function (evt) {
                    var newValue = parseInt(this.$.getRecoveredBalls.innerHTML) + 1;
                    this.$.getRecoveredBalls.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "recoveredBalls": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'recoveredBalls',
                            value: newValue
                        }
                    })
                },

                _subtractRecoveredBalls: function (evt) {
                    var newValue = parseInt(this.$.getRecoveredBalls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getRecoveredBalls.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "recoveredBalls": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'recoveredBalls',
                            value: newValue
                        }
                    })
                },

                _addFreeshotsScored: function (evt) {
                    var newValue = parseInt(this.$.getFreeshotsScored.innerHTML) + 1;
                    this.$.getFreeshotsScored.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "freeshotsScored": newValue
                    });
                    this.$.setField.generateRequest();
                    this.$.getGame.generateRequest();
                    var players1 = this.$.getGame.lastResponse.players1;
                    var players2 = this.$.getGame.lastResponse.players2;
                    var team1score = this.$.getGame.lastResponse.team1score;
                    var team2score = this.$.getGame.lastResponse.team2score;
                    var team;
                    for (var pl in players1) {
                        if (this.selected == players1[pl]._id) {
                            team = "team1";
                        }
                    }
                    for (var pl in players2) {
                        if (this.selected == players2[pl]._id) {
                            team = "team2";
                        }
                    }
                    if (team == "team1") {
                        this.$.setGame.body = JSON.stringify({
                            team1score: team1score += 1
                        })
                    }
                    else if (team == "team2") {
                        this.$.setGame.body = JSON.stringify({
                            team2score: team2score += 1
                        })
                    }
                    this.$.setGame.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'freeShotsScored',
                            value: newValue
                        }
                    })
                },

                _subtractFreeshotsScored: function (evt) {
                    var newValue = parseInt(this.$.getFreeshotsScored.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFreeshotsScored.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "freeshotsScored": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'freeShotsScored',
                            value: newValue
                        }
                    })
                },

                _addFreeshotsMissed: function (evt) {
                    var newValue = parseInt(this.$.getFreeshotsMissed.innerHTML) + 1;
                    this.$.getFreeshotsMissed.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "freeshotsMissed": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'freeShotsMissed',
                            value: newValue
                        }
                    })
                },

                _subtractFreeshotsMissed: function (evt) {
                    var newValue = parseInt(this.$.getFreeshotsMissed.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFreeshotsMissed.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "freeshotsMissed": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'freeShotsMissed',
                            value: newValue
                        }
                    })
                },
                _addFouls: function (evt) {
                    var newValue = parseInt(this.$.getFouls.innerHTML) + 1;
                    this.$.getFouls.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "fouls": newValue
                    });
                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'fouls',
                            value: newValue
                        }
                    })
                },

                _subtractFouls: function (evt) {
                    var newValue = parseInt(this.$.getFouls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFouls.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "fouls": newValue
                        });

                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'fouls',
                            value: newValue
                        }
                    })

                },
                _addTechnicalFouls: function (evt) {
                    var newValue = parseInt(this.$.getTechnicalFouls.innerHTML) + 1;
                    this.$.getTechnicalFouls.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "technicalFouls": newValue
                    });

                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'technicalFouls',
                            value: newValue
                        }
                    })
                },

                _subtractTechnicalFouls: function (evt) {
                    var newValue = parseInt(this.$.getTechnicalFouls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getTechnicalFouls.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "technicalFouls": newValue
                        });
                        this.$.setField.generateRequest();
                    }
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'technicalFouls',
                            value: newValue
                        }
                    })
                },
                _addUnsportsmanshipFouls: function (evt) {
                    var newValue = parseInt(this.$.getUnsportsmanshipFouls.innerHTML) + 1;
                    this.$.getUnsportsmanshipFouls.innerHTML = newValue;
                    this.$.setField.body = JSON.stringify({
                        "unsportsmanshipFouls": newValue
                    });

                    this.$.setField.generateRequest();
                    socket.emit("player-update-stat", {
                        id : this.selected,
                        data: {
                            type: 'unsportsmanshipFouls',
                            value: newValue
                        }
                    })
                },

                _subtractUnsportsmanshipFouls: function (evt) {
                    var newValue = parseInt(this.$.getUnsportsmanshipFouls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getUnsportsmanshipFouls.innerHTML = newValue;
                        this.$.setField.body = JSON.stringify({
                            "unsportsmanshipFouls": newValue
                        });
                        this.$.setField.generateRequest();
                        socket.emit("player-update-stat", {
                            id : this.selected,
                            data: {
                                type: 'unsportsmanshipFouls',
                                value: newValue
                            }
                        })
                    }
                },
            });
        })();

        function updateFouls(data) {
            console.log(data)
        }
        function updateFreeShots(data) {
            console.log(data)
        }
        function updateAssists(data) {
            console.log(data)
        }
        function updatePasses(data) {
            console.log(data)
        }
        ;
    </script>

</dom-module>

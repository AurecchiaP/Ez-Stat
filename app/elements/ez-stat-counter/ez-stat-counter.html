<link rel="import" href="../../components/polymer/polymer.html">

<!-- build:remove -->
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/iron-icon/iron-icon.html">
<link rel="import" href="../../components/iron-icons/av-icons.html">
<link rel="import" href="../../components/iron-icons/image-icons.html">
<!-- /build -->

<dom-module id="ez-stat-counter">
    <template>

        <!-- build:remove -->

        <style>
            :host {
                display: block;
                -webkit-transition: background 0.3s, box-shadow 0.3s;
                -moz-transition: background 0.3s, box-shadow 0.3s;
            }

            .text {
                position: relative;
                top: 0.5em;
            }

            .secondary {
                position: relative;
                top: -0.8em;
                font-size: 0.8em;
                color: rgba(0, 0, 0, 0.6);
            }

            .button {
                transition: all 0.2s;

            }

            .button[disabled] {
                background-color: rgba(0,0,0,0);
            }

            .button:hover {
                background: rgba(0, 0, 0, 0.2);
            }

            .inline-container {
                display: flex;
                justify-content: space-around;
            }


        </style>
        <iron-ajax
                id="setGame"
                url="/games/[[game._id]]"
                handle-as="json"
                content-type="application/json"
                method="PUT"
                debounce-duration="3000">
        </iron-ajax>

        <iron-ajax
                id="getPlayer"
                auto
                url="/players/[[selected]]"
                handle-as="json"
                last-response="{{player}}"
                debounce-duration="300"></iron-ajax>
        <paper-item>

            <iron-ajax
                    id="setAssist"
                    url="/players/[[selected]]"
                    handle-as="json"
                    content-type="application/json"
                    method="PUT"
                    timeout="1000">
            </iron-ajax>

            <p id="selectPlayer" style="display: none">[[selected]]</p>
            <!--<p id="selectPlayer">[[selected]]</p>-->
            <paper-item-body two-line>
                <div class="inline-container">
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractAssist">-</paper-button>
                    </template>
                    <div class="text">
                        <div id="getAssists">{{player.assists}}</div>
                        <div class="secondary">assists</div>
                    </div>
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addAssist">+</paper-button>
                    </template>
                </div>
                <div class="inline-container">
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractPasses">-</paper-button>
                    </template>
                    <div class="text">
                        <div id="getPasses">{{player.passes}}</div>
                        <div class="secondary">passes</div>
                    </div>
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addPasses">+</paper-button>
                    </template>
                </div>
            </paper-item-body>

            <paper-item-body two-line>
                <div class="inline-container">
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractFouls">-</paper-button>
                    </template>
                    <div class="text">
                        <div id="getFouls">{{player.fouls}}</div>
                        <div class="secondary">fouls</div>
                    </div>
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addFouls">+</paper-button>
                    </template>
                </div>
                <div class="inline-container">
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="minus" class="button" on-click="_subtractFreeShots">-</paper-button>
                    </template>
                    <div class="text">
                        <div id="getFreeShots">{{player.freeShots}}</div>
                        <div class="secondary">free shots</div>
                    </div>
                    <template is="dom-if" if="{{editable}}">
                        <paper-button disabled="{{disabled}}" id="plus" class="button" on-click="_addFreeShots">+</paper-button>
                    </template>
                </div>
            </paper-item-body>
        </paper-item>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'ez-stat-counter',

                //
                <!-- build:remove -->
                listeners: {},

                properties: {
                    name: String,
                    href: String,
                    value: String,
                    game: Object,
                    selected: {type: String, notify: true, observer: "changedPlayer"},
                    editable: {
                        type: Boolean,
                        default: false,
                        reflectToAttribute: true
                    },
                    disabled: {
                        type: Boolean,
                        default: true,
                        reflectToAttribute: true
                    }
                },

                changedPlayer: function () {
                    this.$.selectPlayer.innerHTML
                },

                _addAssist: function (evt) {
                    var newValue = parseInt(this.$.getAssists.innerHTML) + 1;
                    this.$.getAssists.innerHTML = newValue;
                    this.$.setAssist.body = JSON.stringify({
                        "assists": newValue
                    });
                    this.$.setAssist.generateRequest();
                },

                _subtractAssist: function (evt) {
                    var newValue = parseInt(this.$.getAssists.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getAssists.innerHTML = newValue;
                        this.$.setAssist.body = JSON.stringify({
                            "assists": newValue
                        });
                        this.$.setAssist.generateRequest();
                    }
                },

                _addFouls: function (evt) {
                    var newValue = parseInt(this.$.getFouls.innerHTML) + 1;
                    this.$.getFouls.innerHTML = newValue;
                    this.$.setAssist.body = JSON.stringify({
                        "fouls": newValue
                    });
                    this.$.setAssist.generateRequest();
                },

                _subtractFouls: function (evt) {
                    var newValue = parseInt(this.$.getFouls.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFouls.innerHTML = newValue;
                        this.$.setAssist.body = JSON.stringify({
                            "fouls": newValue
                        });
                        this.$.setAssist.generateRequest();
                    }
                },

                _addFreeShots: function (evt) {
                    var newValue = parseInt(this.$.getFreeShots.innerHTML) + 1;
                    this.$.getFreeShots.innerHTML = newValue;
                    this.$.setAssist.body = JSON.stringify({
                        "freeShots": newValue
                    });
                    this.$.setAssist.generateRequest();
                },

                _subtractFreeShots: function (evt) {
                    var newValue = parseInt(this.$.getFreeShots.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getFreeShots.innerHTML = newValue;
                        this.$.setAssist.body = JSON.stringify({
                            "freeShots": newValue
                        });
                        this.$.setAssist.generateRequest();
                    }
                },
                _addPasses: function (evt) {
                    var newValue = parseInt(this.$.getPasses.innerHTML) + 1;
                    this.$.getPasses.innerHTML = newValue;
                    this.$.setAssist.body = JSON.stringify({
                        "passes": newValue
                    });
                    this.$.setAssist.generateRequest();
                },

                _subtractPasses: function (evt) {
                    var newValue = parseInt(this.$.getAssists.innerHTML) - 1;
                    if (newValue >= 0) {
                        this.$.getPasses.innerHTML = newValue;
                        this.$.setAssist.body = JSON.stringify({
                            "passes": newValue
                        });
                        this.$.setAssist.generateRequest();
                    }
                }
            });


        })();
    </script>

</dom-module>

<link rel="import" href="../../components/polymer/polymer.html">

<!-- build:remove -->
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/iron-icon/iron-icon.html">
<link rel="import" href="../../components/iron-icons/av-icons.html">
<link rel="import" href="../../components/iron-icons/image-icons.html">
<!-- /build -->

<dom-module id="ez-stat-counter">
    <template>

        <!-- build:remove -->

        <style>
            :host {
                display: block;
                -webkit-transition: background 0.3s, box-shadow 0.3s;
                -moz-transition: background 0.3s, box-shadow 0.3s;
            }

            .text {
                position: relative;
                top: 0.5em;
            }

            .secondary {
                position: relative;
                top: -0.8em;
                font-size: 0.8em;
                color: rgba(0, 0, 0, 0.6);
            }

            .button {
                transition: all 0.2s;

            }

            .button:hover {
                background: rgba(0, 0, 0, 0.2);
            }

            .inline-container {
                display: flex;
            }


        </style>
        <iron-ajax
                id="setGame"
                url="http://localhost:3000/games/[[game._id]]"
                handle-as="json"
                content-type="application/json"
                method="PUT"
                debounce-duration="3000">
        </iron-ajax>

        <iron-ajax
                id="getGame"
                auto
                url="http://localhost:3000/games/[[game._id]]"
                handle-as="json"
                last-response="{{game}}"
                debounce-duration="300"></iron-ajax>

        <paper-item>
            <paper-item-body two-line>
                <div class="inline-container">
                    <paper-button id="minus" class="button" on-click="_subtract">-</paper-button>
                    <div class="text">
                        <div>{{value}}</div>
                        <div class="secondary">Assists</div>
                    </div>
                    <paper-button id="plus" class="button" on-click="_add">+</paper-button>
                </div>
            </paper-item-body>
        </paper-item>
    </template>

    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'ez-stat-counter',

                //
                <!-- build:remove -->
                listeners: {
                },

                properties: {
                    href: String,
                    value: String,
                    game: Object,
                    editable: {
                        type: Boolean,
                        default: false,
                        reflectToAttribute: true
                    }
                },

                _add: function(evt) {
                    var newValue = parseInt(this.value) + 1;
                    this.value = newValue;
                    this.$.setGame.body = JSON.stringify({
                        "assists": newValue
                    });
                    this.$.setGame.generateRequest();
                    this.$.getGame.generateRequest();
                },

                _subtract: function(evt) {
                    var newValue = parseInt(this.value) - 1;
                    if (newValue >= 0) {
                        this.value = newValue;
                        this.$.setGame.body = JSON.stringify({
                            "assists": newValue
                        });
//                        console.log(this.$.setGame.body);
                        this.$.setGame.generateRequest();
                        this.$.getGame.generateRequest();
                    }
                }
            });


        })();
    </script>

</dom-module>
